# txhistory-squid

<img src="assets/TalisFireSquid.svg" alt="Talisman" width="15%" align="right" />

[![squid-link](https://img.shields.io/website?label=squid&style=flat-square&up_message=online&down_message=offline&url=https%3A%2F%2Fapp.gc.subsquid.io%2Fbeta%2Ftx-history%2Fv0b%2Fgraphql)](https://app.gc.subsquid.io/beta/tx-history/v0b/graphql)
[![discord-link](https://img.shields.io/discord/858891448271634473?logo=discord&logoColor=white&style=flat-square)](https://discord.gg/talisman)

**An indexer for multi-chain transaction history in Polkadot.**  
Running on [ðŸ”¥ðŸ¦‘](https://docs.subsquid.io/new-in-fire-squid/).

## Handy resources

- [Subsquid docs](https://docs.subsquid.io/)
- [Subsquid project template](https://github.com/subsquid/squid-template)

## How to set up a development environment

### Requirements

- node 16.x
- docker
- npm -- note that `yarn` package manager is not supported

Example commands below use [make(1)](https://www.gnu.org/software/make/).
Please, have a look at the commands in the [Makefile](Makefile) if your platform doesn't support it.
On Windows we recommend to use [WSL](https://docs.microsoft.com/en-us/windows/wsl/).

```bash
# Install the project dependencies
npm ci

# Start the postgres database
make up

# Run the query and processor nodes (in dev mode)
make dev
```

## Dev flow

### 1. Define database schema

Start development by defining the schema of the target database via `schema.graphql`.
Schema definition consists of regular graphql type declarations annotated with custom directives.
Full description of `schema.graphql` dialect is available [here](https://docs.subsquid.io/schema-spec).

### 2. Generate TypeORM classes

Mapping developers use [TypeORM](https://typeorm.io) entities
to interact with the target database during data processing. All necessary entity classes are
generated by the squid framework from `schema.graphql`. This is done by running `make codegen`
command.

### 3. Generate database migration

All database changes are applied through migration files located at `db/migrations`.
`squid-typeorm-migration(1)` tool provides several commands to drive the process.
It is all [TypeORM](https://typeorm.io/#/migrations) under the hood.

```bash
# Connect to database, analyze its state and generate migration to match the target schema.
# The target schema is derived from entity classes generated earlier.

# Create template file for custom database changes
make create-migration

# Apply database migrations from `db/migrations`
make migrate
```

## Deploy the Squid

Subsquid offers a free hosted service for deploying your Squid. First, build and run the docker image locally and fix any errors or missing files in Dockerfile:

```sh
make dev
```

After the local run, obtain a deployment key by signing into [Aquarium](https://app.subsquid.io/start) and run

```sh
npx sqd auth -k YOUR_DEPLOYMENT_KEY
```

Next, inspect the Squid CLI help to deploy and manage your squid:

```sh
npx sqd squid --help
```

For more information, consult the [Deployment Guide](https://docs.subsquid.io/docs/deploy-squid/).

## License

txhistory-squid is [GPL 3.0 licensed](LICENSE).
